{% extends "base.html" %}

{% macro radio(v, key, label) %}
 <input type="radio" name="{{ key }}" value="{{ v }}"
        {% if request.args.get(key) == v|string %}checked{% endif %}>
 {{ label }}
{% endmacro %}

{% macro radio_group(label, key, radios) %}
<div class="form-group">
<label class="col-sm-2 control-label">{{ label }}</label>
  <label class="checkbox-inline">{{ radio("", key, "なし") }}</label>
{% for value, label in radios %}
  <label class="checkbox-inline">{{ radio(value, key, label) }}</label>
{% endfor %}
</div>
{% endmacro %}

{% block content %}
  <script type="text/javascript">
    $(function(){
     $("form").on("change", function(){ location.href = "?" + $("form").serialize(); })
    });
  </script>
  <h2>企業一覧</h2>
  <h3>最終更新日 {{ service.util.last_date() }}</h3>

  <form action="{{ url_for('index') }}" method="get">
    {{ radio_group("25日移動平均線", "ratio_closing_minus_rolling_mean_25",
       [("15", "15%以上"),
        ("10", "10%以上"),
        ("5",  "5%以上"),
        ("-5", "5%以下"),
        ("-10","10%以下"),
        ("-15","15%以下")]
    ) }}

    {{ radio_group("値上がり率", "ratio_closing1_minus_closing2",
       [("10", "10%以上"),
        ("5",  "5%以上"),
        ("-5", "5%以下"),
        ("-10","10%以下")]
    ) }}

    {{ radio_group("RSI", "closing_rsi_14",
       [("80",  "80%以上(売り)"),
        ("70",  "70%以上(売りかも)"),
        ("-30", "30%以下(買いかも)"),
        ("-20", "20%以下(買い)")]
    ) }}

    {{ radio_group("ボリンジャーバンド", "interval_closing_bollinger_band_20",
       [("-3", "-2~-3シグマ(買い)"),
        ("-2", "-1~-2シグマ(買いかも)"),
        ("-1", "0~-1シグマ"),
        ("1" , "0~1シグマ"),
        ("2" , "1~2シグマ(売りかも)"),
        ("3" , "2~3シグマ(売り)")]
     ) }}

    {{ radio_group("MACD", "closing_macd_minus_signal",
       [("-1", "デッドクロス(売り)"),
        ("1",  "ゴールデンクロス(買い)")]
     ) }}

    {{ radio_group("SLOW STOCHASTIC", "closing_stochastic_d_minus_sd",
       [("-1", "デッドクロス(売り)"),
        ("1",  "ゴールデンクロス(買い)")]
    ) }}
  </form>

  <table>
    <tr>
      <th>Quandl Code</th>
    </tr>
    {% for q in service.quandl.get() %}
    <tr>
      <td><a href="/quandl/{{ q.code }}">{{ q.code }}</a><td>
    </tr>
    {% endfor %}
  </table>

{#

  <table>
    <tr>
      <th>企業数</th>
    </tr>
    <tr>
      <td>{{ company_list|length }}</td>
    </tr>
  </table>

   <table>
      <tr>
          <th>会社名</th>
      </tr>
      {% for c in company_list %}
      <tr>
          <td><a href="{{ url_for('company', id=c.id) }}">{{ c.name }}({{ c.code }})</a><td>
      </tr>
      {% endfor %}
  </table>
#}
{% endblock %}
