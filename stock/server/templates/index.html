{% extends "base.html" %}

{% macro radio(v, key, label) %}
 <input type="radio" name="{{ key }}" value="{{ v }}"
        {% if request.args.get(key) == v|string %}checked{% endif %}>
 {{ label }}
{% endmacro %}

{% macro radio_group(label, key, radios) %}
<div class="form-group">
<label class="col-sm-2 control-label">{{ label }}</label>
{% for value, label in radios %}
  <label class="checkbox-inline">{{ radio(value, key, label) }}</label>
{% endfor %}
</div>
{% endmacro %}

{% block content %}
  <script type="text/javascript">
    $(function(){
     $("form").on("change", function(){ location.href = "?" + $("form").serialize(); })
    });
  </script>
  <h2>企業一覧</h2>
  <h3>最終更新日 {{ service.util.last_date() }}</h3>

  <table>
    <tr>
      <th>企業数</th>
    </tr>
    <tr>
      <td>{{ company_list|length }}</td>
    </tr>
  </table>

  <form action="{{ url_for('index') }}" method="get">
    <label class="col-sm-2 control-label">25日移動平均線 </label>
    <div class="form-group">
    {% for v in [15, 10, 5, -5, -10, -15] %}
      {% set label = "%s%%%s" % (v|abs, v >= 0 and "以上" or "以下") %}
      <label class="checkbox-inline">{{ radio(v, "ratio_closing_minus_rolling_mean_25", "%s" % label) }}</label>
    {% endfor %}
    </div>

    {{ radio_group("値上がり率", "ratio_closing1_minus_closing2",
       [("10", "10%以上"),
        ("5",  "5%以上"),
        ("-5", "5%以下"),
        ("-10","10%以下")]
    ) }}

    <div class="form-group">
    <label class="col-sm-2 control-label">RSI</label>
    {% for value, label in [("80",  "80%以上(売り)"),
                            ("70",  "70%以上(売りかも)"),
                            ("-30", "30%以下(買いかも)"),
                            ("-20", "20%以下(買い)"),
    ] %}
      <label class="checkbox-inline">{{ radio(value, "closing_rsi_14", label) }}</label>
    {% endfor %}
    </div>

    <div class="form-group">
    <label class="col-sm-2 control-label">ボリンジャーバンド</label>
    {% for value, label in [("-3", "-2~-3シグマ(買い)"),
                            ("-2", "-1~-2シグマ(買いかも)"),
                            ("-1", "0~-1シグマ"),
                            ("1" , "0~1シグマ"),
                            ("2" , "1~2シグマ(売りかも)"),
                            ("3" , "2~3シグマ(売り)"),
    ] %}
      <label class="checkbox-inline">{{ radio(value, "interval_closing_bollinger_band_20", label) }}</label>
    {% endfor %}
    </div>

    <div class="form-group">
    <label class="col-sm-2 control-label">MACD</label>
    {% for value, label in [("-1", "デッドクロス(売り)"),
                            ("1",  "ゴールデンクロス(買い)"),
    ] %}
      <label class="checkbox-inline">{{ radio(value, "closing_macd_minus_signal", label) }}</label>
    {% endfor %}
    </div>

    <div class="form-group">
    <label class="col-sm-2 control-label">SLOW STOCHASTIC</label>
    {% for value, label in [("-1", "デッドクロス(売り)"),
                            ("1",  "ゴールデンクロス(買い)"),
    ] %}
      <label class="checkbox-inline">{{ radio(value, "closing_stochastic_d_minus_sd", label) }}</label>
    {% endfor %}
    </div>
    <br>
  </form>
  <ul>
    {% for c in company_list %}
     <li><a href="{{ url_for('company', id=c.id) }}">{{ c.name }}({{ c.code }})</a></li>
   {% endfor %}
  </ul>
{% endblock %}
