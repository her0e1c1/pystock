{% extends "base.html" %}


{% block title %}{{ company.name }} ({{ company.code }}) | {{ super() }}{% endblock %}
{% block keywords %}{{ company.name }},{{ company.code }},{{ super() }}{% endblock %}

{% macro show_signal(key) %}
{% set s = company.search_field.w.signal(key) %}
{% if s != "" %}
 <span class="label label-primary">{{ s }}</span>
{% endif %}
{% endmacro %}

{% block content %}
  <h2>{{ company.name }}</h2>
  <table>
    <tr>
      <th>Code</th>
      <th>Close</th>
      <th>RSI</th>
    </tr>
    <tr>
      <td>{{ company.code }}</td>
      <td></td>
      <td>
        {{ company.search_field.closing_rsi_14 }} {{ show_signal("closing_rsi_14") }}
      </td>
    </tr>
  </table>

  <div id="container" style="min-width: 740px; height: 420px; margin: 0 auto"></div>
  <script type="text/javascript">
    $(function(){
        $.getJSON('/api/{{ company.id }}', function (data) {
            var rolling_means = data.rolling_means.map(function(d){ d.tooltip={valueDecimals: 2}; d.yAxis=0;return d; });
            var percentages = data.percentages.map(function(d){ d.yAxis=2 ; return d; });
            $('#container').highcharts('StockChart', {
                chart: {height: 1000},
                rangeSelector: {
                    selected: 1
                },
                yAxis: [
                    {title: {text: 'OHLC'}, height: '60%'},
                    {title: {text: 'Volume'}, height: '10%', top: '60%'},
                    {title: {text: 'RSI'}, height: '10%', top: '80%'},
                    {title: {text: 'MACD'}, height: '10%', top: '90%'},
                    {title: {text: 'stochastic'}, height: '10%', top: '70%'},
                ],
                series : [
                    {name: 'OHLC', data: data.ohlc, type: 'candlestick', yAxis: 0},
                    {data: data.columns[0].data, type: 'column', yAxis: 1},
                ].concat(rolling_means).concat(percentages).concat(data.macd)
                 .concat(data.stochastic),
            });
        });
    });
  </script>
{% endblock %}
